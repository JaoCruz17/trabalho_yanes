<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="/firebase.js"></script>
</head>
<body class="bg-gray-50 min-h-screen flex">

  <!-- Sidebar -->
  <aside class="w-64 bg-white shadow-md p-6">
    <h2 class="text-xl font-bold mb-8">Gestor de Produtos</h2>
    <nav class="space-y-2">
      <a href="dashboard.html" class="block text-gray-600 hover:text-blue-600">Dashboard</a>
      <a href="produtos.html" class="block text-blue-600 font-semibold">Produtos</a>
      <a href="" class="block text-gray-600 hover:text-blue-600">Usuários</a>
      <button id="logoutBtn" class="mt-8 text-red-500 hover:text-red-700">Sair</button>
    </nav>
  </aside>

  <!-- Conteúdo principal -->
  <main class="flex-1 p-8">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-semibold">Produtos</h1>
      <button id="addProduto" class="bg-blue-600 hover:bg-blue-700 text-white rounded-xl px-4 py-2">
        + Novo Produto
      </button>
    </div>

    <table class="w-full text-left bg-white rounded-xl shadow">
      <thead>
        <tr class="border-b">
          <th class="p-3">Produto</th>
          <th class="p-3">SKU</th>
          <th class="p-3">Categoria</th>
          <th class="p-3">Preço</th>
          <th class="p-3">Estoque</th>
        </tr>
      </thead>
      <tbody id="listaProdutos"></tbody>
    </table>
  </main>

<script type="module">
  import { auth, db } from "./firebase.js";
  import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { collection, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const lista = document.getElementById("listaProdutos");
  const logoutBtn = document.getElementById("logoutBtn");
  const addProduto = document.getElementById("addProduto");

  logoutBtn.addEventListener("click", () =>
    signOut(auth).then(() => (window.location = "index.html"))
  );

  addProduto.addEventListener("click", () => {
    window.location.href = "novo-produto.html";
  });

  onAuthStateChanged(auth, async (user) => {
    if (!user) return (window.location = "index.html");

    const produtosRef = collection(db, "produtos");
    const snapshot = await getDocs(produtosRef);

    lista.innerHTML = "";
    snapshot.forEach((doc) => {
      const p = doc.data();
      lista.innerHTML += `
        <tr class="border-b hover:bg-gray-50">
          <td class="p-3">${p.nome}</td>
          <td class="p-3">${p.sku}</td>
          <td class="p-3">${p.categoria}</td>
          <td class="p-3">R$ ${p.preco}</td>
          <td class="p-3">${p.estoque}</td>
        </tr>`;
    });
  });
</script>

</body>
</html>
